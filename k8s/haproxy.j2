global
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon

defaults
    log     global
    mode    tcp
    retries 2
    timeout client 30m
    timeout connect 4s
    timeout server 30m
    timeout check 5s

frontend main
    bind {{ vip_address }}:6433
    default_backend             app

backend app
    balance     roundrobin
{% for server in groups['master']%}
    server {{ hostvars[server].ansible_hostname}} {{ hostvars[server].ansible_facts.eth1.ipv4.address}}:6443 check
{% endfor %}
    # server control1 192.168.218.171:6443 check
    # server control2 192.168.218.172:6443 check
    # server control3 192.168.218.173:6443 check

listen stats
    bind *:9000
    mode http
    stats enable  # Enable stats page
    stats hide-version  # Hide HAProxy version
    stats realm Haproxy\ Statistics  # Title text for popup window
    stats uri /haproxy_stats  # Stats URI