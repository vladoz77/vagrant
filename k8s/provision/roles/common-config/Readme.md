# Ansible Role: `common-config`

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–∞ —Ä–æ–ª—å –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –±–∞–∑–æ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω (–∏–ª–∏ —Ö–æ—Å—Ç–æ–≤) –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∏ –∑–∞–ø—É—Å–∫–æ–º Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞. –û–Ω–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ü–û, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —è–¥—Ä–æ, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã sysctl, –æ—Ç–∫–ª—é—á–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã Kubernetes.

---

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–∞–≤–∞–º–∏ sudo
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ SSH-–∫–ª—é—á–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è Kubernetes –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ (—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å)
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ SELinux –∏ Firewalld
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π —è–¥—Ä–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —è–¥—Ä–∞ —á–µ—Ä–µ–∑ `sysctl`
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ swap
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `containerd` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å systemd cgroups
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ bash-–∞–ª–∏–∞—Å–æ–≤ –∏ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è `kubectl`

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–æ–ª–∏

```
common-config/
‚îú‚îÄ‚îÄ defaults
‚îÇ   ‚îî‚îÄ‚îÄ main.yaml         # –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ handlers
‚îÇ   ‚îî‚îÄ‚îÄ main.yaml         # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (—Ä–µ—Å—Ç–∞—Ä—Ç —Å–ª—É–∂–±)
‚îú‚îÄ‚îÄ tasks
‚îÇ   ‚îú‚îÄ‚îÄ common.yaml       # –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ config-node.yaml  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∑–ª–∞ (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –ø–∞–∫–µ—Ç—ã, kernel)
‚îÇ   ‚îî‚îÄ‚îÄ main.yaml         # –û—Å–Ω–æ–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ vars
    ‚îî‚îÄ‚îÄ main.yaml         # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –∏ —Ç.–ø.)
```

---

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

### –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`defaults/main.yaml`)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è             | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------------------|----------|
| `username`             | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ |
| `password`             | –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤ –≤–∏–¥–µ plain text) |
| `kubernetesVersion`    | –í–µ—Ä—Å–∏—è Kubernetes |
| `packages`             | –°–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ |
| `pip_modules`          | Python-–º–æ–¥—É–ª–∏, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ —á–µ—Ä–µ–∑ pip |
| `modules`              | –ú–æ–¥—É–ª–∏ —è–¥—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å |
| `sysctl_params`        | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã sysctl –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ |

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`vars/main.yaml`)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è               | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------------------------|----------|
| `docker_repo`            | URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Docker |
| `docker_gpg_key`         | GPG-–∫–ª—é—á –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Docker |
| `kubernetes_repo`        | URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Kubernetes |
| `kubernetes_gpg_key`     | GPG-–∫–ª—é—á –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è Kubernetes |

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- CentOS 7/8/9
- Ansible >= 2.10
- Root-–¥–æ—Å—Ç—É–ø –∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å sudo

---

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```yaml
- hosts: all
  roles:
    - role: common-config
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª—é–±—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ:

```yaml
- hosts: all
  vars:
    username: admin
    password: secure_password
    kubernetesVersion: '1.33'
  roles:
    - role: common-config
```
